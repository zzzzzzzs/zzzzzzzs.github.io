(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Meta_Data"],{3068:function(t,e,a){"use strict";a("46cb")},3810:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",[e("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[e("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[t._v("首页")]),e("el-breadcrumb-item",[t._v("元数据中心")]),e("el-breadcrumb-item",[t._v("元数据中心")])],1),e("el-card",[e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:10}},[e("div",{staticClass:"grid-content bg-purple"},[t._v(" 源端数据库 "),e("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:t.getSchemaAndTable},model:{value:t.sourceId,callback:function(e){t.sourceId=e},expression:"sourceId"}},t._l(t.dataSourceList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.databaseName,value:t.id}})})),1)],1),e("el-row",{attrs:{gutter:24}},[e("el-col",{attrs:{span:14}},[e("el-input",{attrs:{placeholder:"输入关键字进行过滤","label-width":"140px"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),e("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:t.metaDataList,"show-checkbox":"",props:t.defaultProps,"filter-node-method":t.filterNode,"node-key":"name"},on:{"node-click":t.handleNodeClick}})],1)],1)],1),e("el-col",{attrs:{span:4}},[e("el-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary"},on:{click:function(e){t.showSyncStructDialog=!0}}},[t._v("创建表结构 ")])],1),e("el-col",{attrs:{span:10}},[e("div",{staticClass:"grid-content bg-purple"},[t._v(" 目标数据库 "),e("el-cascader",{attrs:{options:t.options,props:t.casProps},on:{change:t.handleChange}})],1)])],1)],1),e("el-dialog",{attrs:{title:"表结构同步",visible:t.showSyncStructDialog,width:"50%"},on:{"update:visible":function(e){t.showSyncStructDialog=e}}},[e("el-form",{attrs:{model:t.syncTableInfo,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"表前缀：",prop:"tablePrefix"}},[e("el-input",{model:{value:t.syncTableInfo.tablePrefix,callback:function(e){t.$set(t.syncTableInfo,"tablePrefix",e)},expression:"syncTableInfo.tablePrefix"}})],1),e("el-form-item",{attrs:{label:"表后缀：",prop:"tableSuffix"}},[e("el-input",{model:{value:t.syncTableInfo.tableSuffix,callback:function(e){t.$set(t.syncTableInfo,"tableSuffix",e)},expression:"syncTableInfo.tableSuffix"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.syncTableStruct}},[t._v("开始同步表结构")])],1)],1)],1)},r=[],l=(a("14d9"),{name:"MetaData",watch:{filterText(t){this.$refs.tree.filter(t)}},data(){return{syncTableInfo:{tablePrefix:"",tableSuffix:""},showSyncStructDialog:!1,options:[],casProps:{lazy:!0,lazyLoad:async(t,e)=>{let{level:a}=t;if(void 0===t.data)return;const{data:s}=await this.$http.get("metadata/getSchemaAndTable",{params:{id:t.data.value}});if(200!==s.code)return this.$message.error("获取元数据失败！");const r=s.data.map(t=>({value:t.name,label:t.name,leaf:a>=1}));e(r)}},filterText:"",dataSourceList:[],sourceId:"",targetData:{targetId:"",targetSchema:""},metaDataList:[],metaInfos:[],defaultProps:{children:"tables",label:"name"}}},created(){this.getDataSourceList()},methods:{async localFlinkCDC(){const{data:t}=await this.$http.post("metadata/localFlinkCDC",{sourceId:this.sourceId,targetData:this.targetData,tables:this.$refs.tree.getCheckedNodes(!0)})},handleChange(t){this.targetData.targetId=t[0],this.targetData.targetSchema=t[1]},async handleNodeClick(t){const e=this.$refs.tree.getNode(t.name);if(0===e.childNodes.length){const{data:e}=await this.$http.get("metadata/listColumns",{params:{id:this.sourceId,schemaName:t.schema,tableName:t.name}});if(200!==e.code)return this.$message.error("获取列元数据失败！")}},async syncTableStruct(){if(""===this.targetData.targetId)return this.$message.error("未选择目标数据库");this.showSyncStructDialog=!1;const{data:t}=await this.$http.post("metadata/syncTableStruct",{sourceId:this.sourceId,targetData:this.targetData,tables:this.$refs.tree.getCheckedNodes(!0),syncTableInfo:this.syncTableInfo});return 200!==t.code?this.$message.error("同步表结构失败，失败信息 : "+t.message):this.$message.success("同步表结构成功！")},async getDataSourceList(){const{data:t}=await this.$http.get("datasource/listDataSource");if(200!==t.code)return this.$message.error("获取数据源列表失败！");this.dataSourceList=t.data.records,this.dataSourceList.map(t=>{this.options.push({value:t.id,label:t.databaseName})}),this.total=t.data.total},async getSchemaAndTable(){const{data:t}=await this.$http.get("metadata/getSchemaAndTable",{params:{id:this.sourceId}});if(200!==t.code)return this.$message.error("获取元数据失败！");this.metaDataList=t.data},filterNode(t,e){return!t||-1!==e.name.indexOf(t)}}}),o=l,i=(a("3068"),a("2877")),c=Object(i["a"])(o,s,r,!1,null,"325b8b74",null);e["default"]=c.exports},"46cb":function(t,e,a){}}]);
//# sourceMappingURL=Meta_Data.60e6232e.js.map